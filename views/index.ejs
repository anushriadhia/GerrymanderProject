<!DOCTYPE html>
<html>
  <head>
    <title><%= title %></title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js" type="text/javascript"></script>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.2.0/dist/leaflet.css"
    integrity="sha512-M2wvCLH6DSRazYeZRIm1JnYyh22purTM+FDB5CsyxtQJYeKq83arPe5wgbNmcFXGqiSH2XR8dT/fJISVA1r/zQ=="
    crossorigin=""/>
    <script src="https://unpkg.com/leaflet@1.2.0/dist/leaflet.js"
    integrity="sha512-lInM/apFSqyy1o6s89K4iQUKg6ppXEgsVxT35HbzUupEVRh2Eu9Wdl4tHj7dZO0s1uvplcYGmt3498TtHq+log=="
    crossorigin=""></script>
    <link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Raleway">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <link rel="stylesheet" href="stylesheets/style.css">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/c3/0.4.18/c3.min.css" rel="stylesheet" type="text/css" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.17/d3.min.js" type="text/javascript"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/c3/0.4.18/c3.min.js" type="text/javascript"></script>

    <link rel = "stylesheet" href = "//cdn.datatables.net/1.10.16/css/jquery.dataTables.min.css">
    <script src = "//cdn.datatables.net/1.10.16/js/jquery.dataTables.min.js"></script>
    <script src = "https://cdn.datatables.net/1.10.16/js/dataTables.material.min.js"></script>
    <link rel = "stylesheet" href = "//cdnjs.cloudflare.com/ajax/libs/material-design-lite/1.1.0/material.min.css">
    <link rel = "stylesheet" href = "https://cdn.datatables.net/1.10.16/css/dataTables.material.min.css">

    <script src="index.js" type="text/javascript"></script>
  </head>
  <body class="w3-light-grey">

    <!-- Top container -->
    <div class="w3-bar w3-top w3-black w3-large" style="z-index:4">
     <button class="w3-bar-item w3-button w3-hide-large w3-hover-none w3-hover-text-light-grey" onclick="w3_open();"><i class="fa fa-bars"></i>  Menu</button>

     <i class="fa fa-map-marker w3-xxxlarge"></i> Upload Shapefile:
     <input id="upload-map-input" type="file"/>

     <span class="w3-bar-item w3-right">Partisan Gerrymandering Detection</span>
    </div>

    <!-- Sidebar/menu -->
    <nav class="w3-sidebar w3-collapse w3-white w3-animate-left" style="z-index:3;width:300px;" id="mySidebar"><br>
     <div class="w3-container">
       <h5>Map Types</h5>
     </div>
     <div id="div-nav-drawer" class="w3-bar-block">
       <a href="#" class="w3-bar-item w3-button w3-padding-16 w3-hide-large w3-dark-grey w3-hover-black" onclick="w3_close()" title="close menu"><i class="fa fa-remove fa-fw"></i>  Close Menu</a>
       <a href="#" class="w3-bar-item w3-button w3-padding w3-blue"><i class="fa fa-users fa-fw"></i>  Choropleth</a>

     </div>
    </nav>

    <!-- Overlay effect when opening sidebar on small screens -->
    <div class="w3-overlay w3-hide-large w3-animate-opacity" onclick="w3_close()" style="cursor:pointer" title="close side menu" id="myOverlay"></div>

    <!-- !PAGE CONTENT! -->
    <div class="w3-main" style="margin-left:300px;margin-top:43px;">



     <div class="w3-panel">
       <div class="w3-row-padding" style="margin:0 -16px">
         <h5>Choropleth Map</h5>
         <div id="map"></div>
           <div id="div-graphs" class="w3-twothird">
             <table id = "districtTable" class="mdl-data-table">
                <thead>
                    <tr>
                      <th>District</th>
                      <th>Reock</th>
                      <th>Polsby-Popper</th>
                      <th>Schwartzberg</th>
                      <th>X-Symmetry</th>
                      <th>Length-Width</th>
                      <th>Convex-Hull</th>
                    </tr>
                </thead>
                <tbody id="districtTableBody"></tbody>
              </table>
           </div>
           <div id="div-metrics" class="w3-third">
             <h5>District Information</h5>
             <div id = "barChart"></div><br>
             <div id = "lengthwidthBarChart"></div>
           </div>
         </div>
       </div>
     </div>

    <script>
    $(document).ready(function() {

      var ncrGeoJSONDump =  "<%= geoDump %>";
      var obj = JSON.parse(ncrGeoJSONDump.replace(/&#34;/g, '"'));

      var districtTableBodyData = "";

      for (var i = 0; i < Object.keys(obj.features).length; i++) {
        districtTableBodyData += "<tr><th>" + obj.features[i].properties.DISTRICT + "</th><th class = 'colorAnalysis'>" + obj.features[i].properties.Reock.toFixed(3) + "</th><th class = 'colorAnalysis'>" + obj.features[i].properties.PolsbyPopper.toFixed(3) + "</th><th class = 'colorAnalysis'>" +
         obj.features[i].properties.Schwartzberg.toFixed(3) + "</th><th class = 'colorAnalysis'>" + obj.features[i].properties.XSymmetry.toFixed(3) + "</th><th class = 'colorAnalysis'>" + obj.features[i].properties.LengthWidth.toFixed(3) + "</th><th class = 'colorAnalysis'>" +
          obj.features[i].properties.ConvexHull.toFixed(3) + "</th></tr>";
      }

      $('#districtTableBody').html(districtTableBodyData);
      //var table = $('#districtTable').dataTable();
      //table.row(':eq(0)', { page: 'current' }).select();
      $('#districtTable').DataTable( {
        scrollY:        600,
        scrollCollapse: true,
        paging:         false,
        fixedColumns:   true,
        select:         true,
        columnDefs: [
            {
                className: 'mdl-data-table__cell--non-numeric'
            }
        ]
      } );

      $(".colorAnalysis").each(function() {
        // get text into variable
        var colText = $(this).text();
        // need to create an action
        if (colText >= .6) {
          $(this).addClass('bad');
        }
        else if (colText >= 0.4 && colText < .6) {
          $(this).addClass('okay');
        }
        else {
          $(this).addClass('good');
        }
      });

      var barChart = c3.generate({
          title: {
              text: 'District 1 Scores'
          },
          bindto: '#barChart',
          data: {
              type: 'bar',
              json: [
                  { 'indicator': 'Reock', 'score': obj.features[0].properties.Reock.toFixed(3) },
                  { 'indicator': 'Polsby-Popper', 'score': obj.features[0].properties.PolsbyPopper.toFixed(3) },
                  { 'indicator': 'Schwartzberg', 'score': obj.features[0].properties.Schwartzberg.toFixed(3) },
                  { 'indicator': 'X-Symmetry', 'score': obj.features[0].properties.XSymmetry.toFixed(3) },
                  { 'indicator': 'Length-Width', 'score': obj.features[0].properties.LengthWidth.toFixed(3) },
                  { 'indicator': 'Convex-Hull', 'score': obj.features[0].properties.ConvexHull.toFixed(3) }
              ],
              keys: {
                  x: 'indicator',
                  value: ['score']
              }
          },
          axis: {
                  x: {
                      type: 'category'
                  },
                  y: {
                      max: 1,
                      min: 0,
                      padding: {top:0, bottom:0}
                  }
          },
          bar: {
              width: {
                  ratio: .9
              }
          }
      });


      var lengthwidthStateAverage = 0;

      for (var i = 0; i < Object.keys(obj.features).length; i++) {
        lengthwidthStateAverage += obj.features[i].properties.LengthWidth;
      }

      lengthwidthStateAverage = lengthwidthStateAverage / Object.keys(obj.features).length;

      var lengthwidthBarChart = c3.generate({
          title: {
              text: 'District 1 Length-Width'
          },
          bindto: '#lengthwidthBarChart',
          data: {
              type: 'bar',
              json: [
                  { 'indicator': 'District 1', 'score': obj.features[0].properties.LengthWidth.toFixed(3) },
                  { 'indicator': 'State Average', 'score': lengthwidthStateAverage.toFixed(3) }
              ],
              keys: {
                  x: 'indicator',
                  value: ['score']
              }
          },
          axis: {
                  x: {
                      type: 'category'
                  },
                  y: {
                      max: 1,
                      min: 0,
                      padding: {top:0, bottom:0}
                  }
          },
          bar: {
              width: {
                  ratio: .9
              }
          }
      });


    });

    </script>
    <!-- <div id = "geoDump"></div> -->
  </body>
</html>
