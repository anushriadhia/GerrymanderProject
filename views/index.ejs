<!DOCTYPE html>
<html>
  <head>
    <title><%= title %></title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js" type="text/javascript"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.17/d3.min.js"></script>
    <link rel = "stylesheet" href ="https://cdnjs.cloudflare.com/ajax/libs/c3/0.4.18/c3.min.css">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.2.0/dist/leaflet.css"
   integrity="sha512-M2wvCLH6DSRazYeZRIm1JnYyh22purTM+FDB5CsyxtQJYeKq83arPe5wgbNmcFXGqiSH2XR8dT/fJISVA1r/zQ=="
   crossorigin=""/>
   <script src="https://unpkg.com/leaflet@1.2.0/dist/leaflet.js"
  integrity="sha512-lInM/apFSqyy1o6s89K4iQUKg6ppXEgsVxT35HbzUupEVRh2Eu9Wdl4tHj7dZO0s1uvplcYGmt3498TtHq+log=="
  crossorigin=""></script>
    <script src = "https://cdnjs.cloudflare.com/ajax/libs/c3/0.4.18/c3.min.js"></script>
    <link rel='stylesheet' href='/stylesheets/style.css'/>
  </head>
  <body>

    <!DOCTYPE html>
    <html>
    <title>W3.CSS Template</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Raleway">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <link rel="stylesheet" href="stylesheets/style.css">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/c3/0.4.18/c3.min.css" rel="stylesheet" type="text/css" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.17/d3.min.js" type="text/javascript"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/c3/0.4.18/c3.min.js" type="text/javascript"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js" type="text/javascript"></script>
    <script src="index.js" type="text/javascript"></script>
    <style>
    html,body,h1,h2,h3,h4,h5 {font-family: "Raleway", sans-serif}
    </style>
    <body class="w3-light-grey">

    <!-- Top container -->
    <div class="w3-bar w3-top w3-black w3-large" style="z-index:4">
     <button class="w3-bar-item w3-button w3-hide-large w3-hover-none w3-hover-text-light-grey" onclick="w3_open();"><i class="fa fa-bars"></i>  Menu</button>
     <span class="w3-bar-item w3-right">Partisan Gerrymandering Detection</span>
    </div>

    <!-- Sidebar/menu -->
    <nav class="w3-sidebar w3-collapse w3-white w3-animate-left" style="z-index:3;width:300px;" id="mySidebar"><br>
     <div class="w3-container w3-row">
       <div class="w3-col s4">
         <img src="/w3images/avatar2.png" class="w3-circle w3-margin-right" style="width:46px">
       </div>
       <div class="w3-col s8 w3-bar">
         <span>Welcome, <strong>Mike</strong></span><br>
         <a href="#" class="w3-bar-item w3-button"><i class="fa fa-envelope"></i></a>
         <a href="#" class="w3-bar-item w3-button"><i class="fa fa-user"></i></a>
         <a href="#" class="w3-bar-item w3-button"><i class="fa fa-cog"></i></a>
       </div>
     </div>
     <hr>
     <div class="w3-container">
       <h5>Graph Types</h5>
     </div>
     <div id="div-nav-drawer" class="w3-bar-block">
       <a href="#" class="w3-bar-item w3-button w3-padding-16 w3-hide-large w3-dark-grey w3-hover-black" onclick="w3_close()" title="close menu"><i class="fa fa-remove fa-fw"></i>  Close Menu</a>
       <a href="#" class="w3-bar-item w3-button w3-padding w3-blue"><i class="fa fa-users fa-fw"></i>  Overview</a>

     </div>
    </nav>


    <!-- Overlay effect when opening sidebar on small screens -->
    <div class="w3-overlay w3-hide-large w3-animate-opacity" onclick="w3_close()" style="cursor:pointer" title="close side menu" id="myOverlay"></div>

    <!-- !PAGE CONTENT! -->
    <div class="w3-main" style="margin-left:300px;margin-top:43px;">

     <!-- Header -->
     <header class="w3-container" style="padding-top:22px">
       <h5><b><i class="fa fa-dashboard"></i> My Dashboard</b></h5>
     </header>

     <div class="w3-row-padding w3-margin-bottom">
       <div class="w3-quarter">
         <div class="w3-container w3-red w3-padding-16">
           <div class="w3-left"><i class="fa fa-warning w3-xxxlarge"></i></div>
           <div class="w3-right">
             <h3 id="warnings-text"></h3>
           </div>
           <div class="w3-clear"></div>
           <h4>Gerrymandering Warnings</h4>
         </div>
       </div>
       <div class="w3-quarter">
         <div class="w3-container w3-blue w3-padding-16">
           <div class="w3-left"><i class="fa fa-thumbs-up w3-xxxlarge"></i></div>
           <div class="w3-right">
             <h3 id="safe-metrics-text"></h3>
           </div>
           <div class="w3-clear"></div>
           <h4>Safe Metrics</h4>
         </div>
       </div>
       <div class="w3-quarter">
         <div class="w3-container w3-teal w3-padding-16">
           <div class="w3-left"><i class="fa fa-map-marker w3-xxxlarge"></i></div>
           <div class="w3-right">
             <input id="upload-map-input" type="file"/>
           </div>
           <div class="w3-clear"></div>
           <h4>Upload Map File</h4>
         </div>
       </div>
       <div class="w3-quarter">
         <div class="w3-container w3-orange w3-text-white w3-padding-16">
           <div class="w3-left"><i class="fa fa-user w3-xxxlarge"></i></div>
           <div class="w3-right">
             <input id="upload-demographics-input" type="file"/>
           </div>
           <div class="w3-clear"></div>
           <h4>Upload Demographics File</h4>
         </div>
       </div>
     </div>

     <div class="w3-panel">
       <div class="w3-row-padding" style="margin:0 -16px">
         <div id="div-graphs" class="w3-twothird">
           <div id="map">

           </div>
           <!-- <h5>Regions</h5>
           2016 NC Election Information:
           <div id = "pieChart"></div>
           <div id = "barChart"></div>
           <div id = "timeChart"></div> -->
           <img src="/w3images/region.jpg" style="width:100%" alt="Google Regional Map">
         </div>
         <div id="div-metrics" class="w3-third">
           <h5>Metrics</h5>
           <table id="metrics-table" class="w3-table w3-striped w3-white">
             <tr>
               <!-- <td><i class="fa fa-user w3-text-blue w3-large"></i></td>
               <td>New record, over 90 views.</td>
               <td><i>10 mins</i></td>
             </tr>
             <tr>
               <td><i class="fa fa-bell w3-text-red w3-large"></i></td>
               <td>Database error.</td>
               <td><i>15 mins</i></td>
             </tr>
             <tr>
               <td><i class="fa fa-users w3-text-yellow w3-large"></i></td>
               <td>New record, over 40 users.</td>
               <td><i>17 mins</i></td>
             </tr>
             <tr>
               <td><i class="fa fa-comment w3-text-red w3-large"></i></td>
               <td>New comments.</td>
               <td><i>25 mins</i></td>
             </tr>
             <tr>
               <td><i class="fa fa-bookmark w3-text-blue w3-large"></i></td>
               <td>Check transactions.</td>
               <td><i>28 mins</i></td>
             </tr>
             <tr>
               <td><i class="fa fa-laptop w3-text-red w3-large"></i></td>
               <td>CPU overload.</td>
               <td><i>35 mins</i></td>
             </tr>
             <tr>
               <td><i class="fa fa-share-alt w3-text-green w3-large"></i></td>
               <td>New shares.</td>
               <td><i>39 mins</i></td>
             </tr> -->
           </table>
         </div>
       </div>
     </div>
     <hr>
     <!-- <div class="w3-container">
       <h5>General Stats</h5>
       <p>New Visitors</p>
       <div class="w3-grey">
         <div class="w3-container w3-center w3-padding w3-green" style="width:25%">+25%</div>
       </div>

       <p>New Users</p>
       <div class="w3-grey">
         <div class="w3-container w3-center w3-padding w3-orange" style="width:50%">50%</div>
       </div>

       <p>Bounce Rate</p>
       <div class="w3-grey">
         <div class="w3-container w3-center w3-padding w3-red" style="width:75%">75%</div>
       </div>
     </div>
     <hr> -->

     <!-- <div class="w3-container">
       <h5>Countries</h5>
       <table class="w3-table w3-striped w3-bordered w3-border w3-hoverable w3-white">
         <tr>
           <td>United States</td>
           <td>65%</td>
         </tr>
         <tr>
           <td>UK</td>
           <td>15.7%</td>
         </tr>
         <tr>
           <td>Russia</td>
           <td>5.6%</td>
         </tr>
         <tr>
           <td>Spain</td>
           <td>2.1%</td>
         </tr>
         <tr>
           <td>India</td>
           <td>1.9%</td>
         </tr>
         <tr>
           <td>France</td>
           <td>1.5%</td>
         </tr>
       </table><br>
       <button class="w3-button w3-dark-grey">More Countries  <i class="fa fa-arrow-right"></i></button>
     </div>
     <hr>
     <div class="w3-container">
       <h5>Recent Users</h5>
       <ul class="w3-ul w3-card-4 w3-white">
         <li class="w3-padding-16">
           <img src="/w3images/avatar2.png" class="w3-left w3-circle w3-margin-right" style="width:35px">
           <span class="w3-xlarge">Mike</span><br>
         </li>
         <li class="w3-padding-16">
           <img src="/w3images/avatar5.png" class="w3-left w3-circle w3-margin-right" style="width:35px">
           <span class="w3-xlarge">Jill</span><br>
         </li>
         <li class="w3-padding-16">
           <img src="/w3images/avatar6.png" class="w3-left w3-circle w3-margin-right" style="width:35px">
           <span class="w3-xlarge">Jane</span><br>
         </li>
       </ul>
     </div>
     <hr> -->

     <!-- <div class="w3-container">
       <h5>Recent Comments</h5>
       <div class="w3-row">
         <div class="w3-col m2 text-center">
           <img class="w3-circle" src="/w3images/avatar3.png" style="width:96px;height:96px">
         </div>
         <div class="w3-col m10 w3-container">
           <h4>John <span class="w3-opacity w3-medium">Sep 29, 2014, 9:12 PM</span></h4>
           <p>Keep up the GREAT work! I am cheering for you!! Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua.</p><br>
         </div>
       </div>

       <div class="w3-row">
         <div class="w3-col m2 text-center">
           <img class="w3-circle" src="/w3images/avatar1.png" style="width:96px;height:96px">
         </div>
         <div class="w3-col m10 w3-container">
           <h4>Bo <span class="w3-opacity w3-medium">Sep 28, 2014, 10:15 PM</span></h4>
           <p>Sed do eiusmod tempor incididunt ut labore et dolore magna aliqua.</p><br>
         </div>
       </div>
     </div>
     <br>
     <div class="w3-container w3-dark-grey w3-padding-32">
       <div class="w3-row">
         <div class="w3-container w3-third">
           <h5 class="w3-bottombar w3-border-green">Demographic</h5>
           <p>Language</p>
           <p>Country</p>
           <p>City</p>
         </div>
         <div class="w3-container w3-third">
           <h5 class="w3-bottombar w3-border-red">System</h5>
           <p>Browser</p>
           <p>OS</p>
           <p>More</p>
         </div>
         <div class="w3-container w3-third">
           <h5 class="w3-bottombar w3-border-orange">Target</h5>
           <p>Users</p>
           <p>Active</p>
           <p>Geo</p>
           <p>Interests</p>
         </div>
       </div>
     </div> -->

     <!-- Footer -->
     <!-- <footer class="w3-container w3-padding-16 w3-light-grey">
       <h4>FOOTER</h4>
       <p>Thanks for visiting!</p>
     </footer> -->

     <!-- End page content -->
    </div>

    <script>
    // Get the Sidebar
    var mySidebar = document.getElementById("mySidebar");

    // Get the DIV with overlay effect
    var overlayBg = document.getElementById("myOverlay");

    // Toggle between showing and hiding the sidebar, and add overlay effect
    function w3_open() {
       if (mySidebar.style.display === 'block') {
           mySidebar.style.display = 'none';
           overlayBg.style.display = "none";
       } else {
           mySidebar.style.display = 'block';
           overlayBg.style.display = "block";
       }
    }

    // Close the sidebar with the close button
    function w3_close() {
       mySidebar.style.display = "none";
       overlayBg.style.display = "none";
    }
    </script>





















    <h1><%= title %></h1>
    <p>Welcome to <%= title %></p>
    2016 NC Election Information:
    <div id = "pieChart"></div>
    <div id = "barChart"></div>
    <div id = "timeChart"></div>
    <script>
        $(document).ready(function() {

            var pieChart = c3.generate({
                title: {
                    text: '2016 NC Registered Voter Party Affiliation'
                },
                bindto: '#pieChart',
                data: {
                    // iris data from R
                    columns: [
                        ['Democrat', <%= var1 %>],
                        ['Republican', 33],
                        ['Independent', 30],
                    ],
                    type : 'pie'//,
                    //onclick: function (d, i) { console.log("onclick", d, i); },
                    //onmouseover: function (d, i) { console.log("onmouseover", d, i); },
                    //onmouseout: function (d, i) { console.log("onmouseout", d, i); }
                }
            });

            var barChart = c3.generate({
                title: {
                    text: '2016 NC Registered Voter Party Affiliation'
                },
                bindto: '#barChart',
                data: {
                    // iris data from R
                    columns: [
                        ['Democrat', 57],
                        ['Republican', 33],
                        ['Independent', 10],
                    ],
                    type : 'bar'//,
                    //onclick: function (d, i) { console.log("onclick", d, i); },
                    //onmouseover: function (d, i) { console.log("onmouseover", d, i); },
                    //onmouseout: function (d, i) { console.log("onmouseout", d, i); }
                },
                bar: {
                    width: {
                        ratio: 0.5
                    }
                }
            });

            //var vector = <%- vec1 %>.toString();

            //var vecsub = vector.substring(1,vector.indexOf("]"));

            //var vec2 = vector.replace("{","[");
            //vec2 = vec2.replace("}","]");

            //console.log(vec2);

            //console.log(vecsub);

            var timeChart = c3.generate({
                title: {
                    text: '2016 NC Voter Gubernatorial Preference'
                },
                bindto: '#timeChart',
                data: {
                    x: 'x',
                    columns: [

                        ['x', '2016-01-01', '2016-02-01'],
                        ['McCrory', 37,54],
                        ['Cooper', 42, 40]
                    ],
                },
                axis: {
                    x: {
                        type: 'timeseries',
                        tick: {
                            format: "%Y-%m-%d"
                        }
                    }
                }
            });
        });

        var ncrGeoJSONDump =  "<%= geoDump %>)";
        console.log(ncrGeoJSONDump);
        $('#geoDump').html(ncrGeoJSONDump);

        initMap();

        function initMap() {
          var map = L.map('map').setView([35, -80], 6);

          L.tileLayer('https://api.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.png?access_token=sk.eyJ1IjoiaGV5aXRzbWVkeiIsImEiOiJjajk1bWQ5dmwxbWw5MzJwOXV4bm9hM3JpIn0.sTN2b2Bjxh9mM7HsrCfbsg', {
              attribution: 'Map data &copy; <a href="http://openstreetmap.org">OpenStreetMap</a> contributors, <a href="http://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, Imagery © <a href="http://mapbox.com">Mapbox</a>',
              maxZoom: 18,
              id: 'mapbox.streets',
              accessToken: 'sk.eyJ1IjoiaGV5aXRzbWVkeiIsImEiOiJjajk1bWQ5dmwxbWw5MzJwOXV4bm9hM3JpIn0.sTN2b2Bjxh9mM7HsrCfbsg'
          }).addTo(map);


          // temporary
          var xmlhttp = new XMLHttpRequest();
          xmlhttp.onreadystatechange = function() {
            if (this.readyState == 4 && this.status == 200) {
              console.log(this.responseText);
              var myObj = JSON.parse(this.responseText);
              L.geoJSON(myObj, {style: style}).addTo(map);

            }
          };
          xmlhttp.open("GET", "ncr.geojson", true);
          xmlhttp.send();
          //

        }

        function getColor(d) {
          return d > 1000 ? '#800026' :
          d > 500  ? '#BD0026' :
          d > 200  ? '#E31A1C' :
          d > 100  ? '#FC4E2A' :
          d > 50   ? '#FD8D3C' :
          d > 20   ? '#FEB24C' :
          d > 10   ? '#FED976' :
          '#FFEDA0';
        }

        function style(feature) {
          return {
            fillColor: getColor(feature.properties.Compactness),
            weight: 2,
            opacity: 1,
            color: 'white',
            dashArray: '3',
            fillOpacity: 0.7
          };
        }


    </script>
    <div id = "geoDump">

    </div>


  </body>
</html>
